# Начало работы с Node.js

## Node.js в двух словах
##### Начало работы с Node.js

![](http://blog-assets.risingstack.com/2016/Mar/node_js_logo_in_node_hero_getting_started_tutorial-1458726703612.png)
*Официальное лого Node.js*

### Знакомство с Server-side JavaScript
Изначально  JavaScript запускался в браузере, осуществлялось посредством “движка” v8.

Чтобы ваш JavaScript код выполнился на вычислительной машине вне браузера (на backend), он должен быть интерпретирован и, конечно же, выполнен. Именно это и делает Node.js. Для этого он использует движок V8 VM от Google — ту же самую среду исполнения для JavaScript, которую использует браузер Google Chrome.

Кроме того, Node.js поставляется со множеством полезных модулей, так что вам не придется писать всё с нуля, как, например, вывод строки в консоль.

Таким образом, Node.js состоит из 2 вещей: среды исполнения и полезных библиотек.

*Node.js — это среда выполнения JavaScript, построенная на JavaScript-движке V8 из Chrome. В основе Node.js лежит **событийно-управляемая модель с неблокирующими операциями I/O**, что делает её легкой и эффективной.*

Другими словами: Node.js предлагает вам возможность писать невероятно производительный серверный код с использованием JavaScript. Как говорится в официальном описании: Node.js — это среда выполнения, использующая тот же  JavaScript-движок V8, который вы можете найти в браузере Google Chrome. Но этого недостаточно для успеха Node.js. В Node.js используется libuv - кросс-платформенная библиотека поддержки с акцентом на асинхронный ввод-вывод.

![](http://blog-assets.risingstack.com/2016/Mar/libuv_logo_in_node_hero_getting_started_tutorial-1458726737329.png)
*Официальное лого libuv*

С точки зрения разработчика, Node.js однопоточна, но под капотом **libuv использует треды, события файловой системы, реализует цикл событий, включает в себя тред-пулинг** и так далее. В большинстве случаев вы не будете взаимодействовать с libuv напрямую.

## Установка Node.js для старта

Последнюю версию Node.js вы можете найти на официальном сайте: [https://nodejs.org/en/download/](https://nodejs.org/en/download/).

При таком подходе довольно легко начать работу, но если позже вы захотите добавить в систему больше версий Node.js, лучше начать использовать [nvm](https://github.com/creationix/nvm) (*node version manager*) - диспетчер версий Node.js.

После его установки вы сможете использовать очень простой CLI API для смены версии Node.js:

Чтобы убедиться, что у вас установлена и запущена Node.js, выполните:

```
node -v
```

Если все в порядке, эта команда вернет номер версии текущего активного бинарного файла Node.js.

Проверяем версию -  node -v //получаем текущую версию
Доступны многие методы, за исключением Alert и работы с DOM-деревом, но можно вызвать привычное console.log

Первый — без аргументов: данная команда откроет интерактивный режим в командной строке, где вы можете исполнять код JavaScript.$ node > 
console.log(‘Hello World’); 
Hello World 
undefined

В этом примере я просто набираем “console.log(‘Hello World’);” и нажимаем на Enter. Node начнет выполнять, и мы увидим наше сообщение. Также он напишет “undefined”, потому что печатает возвращаемое значение, и console.log не возвращает ничего.   — Другой способ использования Node.js — это создание файла Javascript.

**Хорошо, теперь мы знаем, как устанавливать Node.js и переключаться между её версиями, но в чём смысл?**

С тех пор как был сформирован Node.js Foundation, Node.js имеет план релизов. Это очень похоже на другие проекты Linux Foundation. Это означает, что есть два релиза: стабильный и экспериментальный. В Node.js стабильными версиями с долговременной поддержкой (LTS) являются те, которые начинаются с четных чисел (4, 6, 8, ...). Экспериментальные версии нумеруются нечетными числами (5, 7, ...).

Мы рекомендуем использовать версию LTS в продакшене и пробовать новые возможности с экспериментальной версией.

## Hello World

Чтобы начать работу с Node.js, давайте попробуем её в консоли! Запустите Node.js, просто набрав `node`:

```
$ node
>
```

Хорошо, давайте попробуем что-то напечатать:

```
$ node
> console.log('hello from Node.js')
```

После нажатия Enter вы получите следующее:

```
> console.log('hello from Node.js')
hello from Node.js
undefined
```

Пришло время создать наше приложение Hello Node.js!

Начнем с создания файла `index.js`. Откройте свою IDE (Atom, Sublime, Code — выбор за вами), создайте новый файл и сохраните его с именем `index.js`. Если вы закончили, скопируйте в него следующий фрагмент кода:

```
// index.js
console.log('hello from Node.js')
```

Чтобы запустить этот файл, вы должны снова открыть свой терминал и перейти в каталог, в котором размещён `index.js`.

Как только вы успешно переместитесь в нужное место, запустите файл, используя команду `node index.js`. Вы увидите, что эта команда будет выдавать тот же результат, что и раньше, выводя строку непосредственно в терминале.

## Модульность для вашего приложения

Теперь у вас есть файл `index.js`, поэтому пришло время перейти на следующий уровень! Давайте создадим что-то более сложное, разделив наш исходный код на несколько JavaScript-файлов с целью удобочитаемости и поддерживаемости. Чтобы начать работу, вернитесь в свою IDE и создайте следующую структуру каталогов (с пустыми файлами), но пока не трогайте `package.json`, мы сгенерируем его автоматически на следующем шаге:

```
├── app
|  ├── calc.js
|  └── index.js
├── index.js
└── package.json
```

Каждый проект Node.js начинается с создания файла `package.json`. Вы можете думать о нем как о JSON-представлении приложения и его зависимостей. Он содержит имя вашего приложения, автора (вас) и все зависимости, необходимые для запуска приложения. *Мы рассмотрим раздел зависимостей позже в главе «Использование NPM».*

Вы можете интерактивно генерировать файл `package.json` с помощью команды `npm init` в терминале. После запуска команды вас попросят ввести некоторые данные, например имя вашего приложения, версию, описание и так далее. Не нужно беспокоиться, просто нажимайте Enter, пока не получите сформированный JSON и вопрос `is it ok?`. Нажмите Enter в последний раз и вуаля: ваш `package.json` был автоматически сгенерирован и помещен в папку вашего приложения.
Можно сократить процес и сразу задать `npm init -y`
 Если вы откроете этот файл в своей IDE, он будет очень похож на фрагмент кода ниже.

```javascript
// package.json
{
  "name": "@node-hero",
  "version": "1.0.0",
  "description": "",
  "main": "index.js",
  "scripts": {
    "test": "echo \"Error: no test specified\" && exit 1",
    "start": "node index.js"
  },
  "author": "", "license": "ISC"
}
```

Хорошей практикой является добавление стартового скрипта в ваш пакет `package.json`. Как только вы это сделаете, как показано в примере выше, вы можете запустить приложение с помощью команды `npm start`. Это очень удобно, когда вы хотите развернуть свое приложение у PaaS-провайдера: они могут распознать команду `start` и использовать её для запуска приложения.

Теперь давайте вернемся к первому созданному вами файлу под названием `index.js`. Я рекомендую оставить этот файл очень компактным: только подключение самого приложения (файл `index.js` из подкаталога `/app`, созданного ранее). Скопируйте следующий код в свой файл `index.js` и сохраните:

```javascript
// index.js
require('./app/index')
```

Теперь пришло время приступить к созданию реального приложения. Откройте файл `index.js` из папки `/app`, чтобы создать очень простой пример: добавление массива чисел. В этом случае файл `index.js` будет содержать только числа, которые мы хотим добавить, а логика, требующая вычислений, должна быть помещена в отдельный модуль.

Вставьте этот код в файл `index.js` в каталоге `/app`.

```javascript
// app/index.js
const calc = require('./calc')
const numbersToAdd = [
    3,
    4,
    10,
    2
]

const result = calc.sum(numbersToAdd)
console.log(`The result is: ${result}`)
```

Теперь вставьте фактическую бизнес-логику в файл `calc.js`, который можно найти в той же папке.

```javascript
// app/calc.js
function sum (arr) {
    return arr.reduce(function(a, b) {
        return a + b
    }, 0)
}

module.exports.sum = sum
```

Чтобы проверить, всё ли вы сделали правильно, сохраните эти файлы, откройте терминал и введите `npm start` или `node index.js`. Если вы все сделали правильно, вы получите ответ: 19. Если что-то пошло не так, внимательно просмотрите лог в консоли и найдите проблему на его основе.

---

В следующей части под названием «Использование NPM» мы рассмотрим, как использовать NPM - менеджер пакетов для JavaScript.

---

### Задачи, которые должен реализовывать сервер.
У нас — онлайн веб-приложение, поэтому нам нужен HTTP-сервер;

- Нашему серверу необходимо обслуживать различные запросы в зависимости от URL, по которому был сделан запрос. Для этого нам нужен какой-нибудь роутер (маршрутизатор) - он у нас уже есть в React, чтобы иметь возможность направлять запросы определенным обработчикам;

- Для выполнения запросов, пришедших на сервер и направляемые роутером, нам нужны действующие обработчики запросов;

- Роутер, вероятно, должен иметь дело с разными входящими POST-данными и передавать их обработчикам запросов в удобной форме. Для этого нам нужен какой-нибудь обработчик входных данных;

- Мы хотим не только обрабатывать запросы, но и показывать пользователю контент по запрошенным URL-адресам, поэтому нам нужна некая логика отображения для обработчиков запросов, чтобы иметь возможность отправлять контент пользовательскому браузеру;

- Последнее, но не менее важное — пользователь сможет загружать данные, поэтому нам нужен какой-нибудь обработчик загрузки, который возьмёт на себя заботу о деталях.
